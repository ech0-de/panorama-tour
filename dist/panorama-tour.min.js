!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).panoramaTour=t()}(this,(function(){"use strict";return function(e,t){e.classList.add("pt-container"),window.innerWidth>1200?t.default.hfov=120:window.innerWidth>768?t.default.hfov=100:window.innerWidth>576?t.default.hfov=80:t.default.hfov=50,Object.keys(t.scenes).forEach(e=>{t.scenes[e].title=e,Array.isArray(t.scenes[e].relations)&&(t.scenes[e].hotSpots=[],t.scenes[e].relations.forEach(n=>{const o=-180*Math.atan2(t.scenes[e].lat-t.scenes[n].lat,t.scenes[e].lon-t.scenes[n].lon)/Math.PI-t.scenes[e].northOffset-90;t.scenes[e].hotSpots.push({pitch:-15,yaw:o,type:"scene",text:t.scenes[n].title,sceneId:n,sceneFadeDuration:800})}))});let n=null;const o=window.pannellum.viewer(e,t),i={pitch:0,yaw:0,hfov:0},a=()=>{i.pitch=o.getPitch(),i.yaw=o.getYaw(),i.hfov=o.getHfov()};if(a(),o.on("mouseup",a),o.on("touchend",a),o.on("load",()=>{let e=0;e=null!==n?t.scenes[n].northOffset:2*t.scenes[o.getScene()].northOffset,n=o.getScene(),e-=t.scenes[n].northOffset,o.lookAt(i.pitch,i.yaw+e,i.hfov,!1),a()}),"object"==typeof L){const i=document.createElement("div");i.classList.add("pt-minimap"),e.querySelector(".pnlm-ui").append(i);const a=L.map(i,t.map),s=document.createElement("div");s.classList.add("pt-minimap-btn"),s.innerHTML='<i class="fa fa-lg fa-map"></i>',s.addEventListener("click",()=>{i.classList.toggle("is-visible"),a.invalidateSize()}),e.querySelector(".pnlm-ui").append(s);const c=L.divIcon({html:'<i class="fa fa-eye"></i>',iconSize:[20,20],className:"pt-minimap-inactive"}),r=L.divIcon({html:'<i class="fa fa-eye"></i>',iconSize:[20,20],className:"pt-minimap-active"});if(!0===t.debug&&a.on("click",e=>{const t=window.prompt("name?");console.log(JSON.stringify({title:"",description:"",lat:e.latlng.lat,lon:e.latlng.lng,northOffset:0,panorama:t,relations:[]},null,2))}),Array.isArray(t.map.elements)){const e={},n=[];for(const o of t.map.elements)"node"===o.type?e[o.id]=o:"way"===o.type&&n.push(o);for(const t of n)t.nodes=t.nodes.map(t=>[e[t].lat,e[t].lon]),(t.tags.hasOwnProperty("indoor")||t.tags.hasOwnProperty("building"))&&L.polygon(t.nodes,{color:"red"}).addTo(a)}if(Array.isArray(t.map.polygons))for(const e of t.map.polygons)L.polygon(e,{color:"red"}).addTo(a);Object.entries(t.scenes).forEach(([e,t])=>{t.marker=L.marker([t.lat,t.lon],{icon:c}).on("click",()=>o.loadScene(e)).addTo(a)}),o.on("load",()=>{null!==n&&t.scenes[n].marker.setIcon(c),t.scenes[n].marker.setIcon(r)})}const s=document.createElement("style");s.innerText=".pnlm-compass,.pt-minimap-btn{background-color:rgba(255,255,255,.5);box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2)}.pt-minimap-btn{width:50px;height:50px;text-align:center;border-radius:50%;cursor:pointer;opacity:.6;transition:.5s;border:1px solid #999;border-color:rgba(0,0,0,.4);display:grid;align-items:center;justify-content:center;position:absolute;right:4px;bottom:58px}.pt-minimap-btn:hover{opacity:1}.pt-minimap{position:absolute!important;top:0;left:0;right:0;width:100vw;height:100vw;display:none;background-color:rgba(0,0,0,.8);transition:.5s;z-index:9999}.pt-minimap.is-visible{display:block}@media (min-width:768px){.pt-minimap{top:auto;right:auto;left:0;bottom:0;width:400px;height:250px;opacity:.2;background-color:rgba(0,0,0,.3);transition:.5s}.pt-minimap:hover{background-color:rgba(0,0,0,.6);opacity:1}}.pt-minimap-inactive{color:#888;font-size:14pt}.pt-minimap-active{color:#fff;font-size:14pt}",s.type="text/css",document.head.appendChild(s)}}));
